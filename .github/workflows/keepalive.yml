name: Keep Streamlit Alive (Browser)

on:
  schedule:
    - cron: "0 */4 * * *"   # every 4 hours
  workflow_dispatch:

jobs:
  keepalive:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install Playwright
        run: |
          pip install playwright
          playwright install chromium

      - name: Wake Streamlit apps
        run: |
          python - <<EOF
from playwright.sync_api import sync_playwright

apps = [
    "https://tnecase-web-page.streamlit.app/",
    "https://tnecase-web-page-sc1.streamlit.app/",
    "https://tneopt-app.streamlit.app/",
    "https://tnecase-opt.streamlit.app/",
    "https://tnecase-web-page-01.streamlit.app/",
    "https://tne-case-web-sc1.streamlit.app/"
]

print("Starting Playwright keepalive...")

with sync_playwright() as p:
    browser = p.chromium.launch(headless=True)
    page = browser.new_page()

    for url in apps:
        print(f"Visiting: {url}")
        try:
            page.goto(url, wait_until="networkidle", timeout=60000)
            print(f"Loaded {url} successfully.")
        except Exception as e:
            print(f"FAILED to load {url}: {e}")

    browser.close()
    print("Done.")
EOF
